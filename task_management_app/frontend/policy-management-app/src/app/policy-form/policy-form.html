<div class="container">
  <div class="header">
    <h1>{{ isEditMode ? 'Edit Policy' : 'Add New Policy' }}</h1>
  </div>

  <div *ngIf="loading" class="loading">{{ isEditMode ? 'Loading policy...' : 'Saving policy...' }}</div>
  
  <div *ngIf="error" class="error">{{ error }}</div>

  <form [formGroup]="policyForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <!-- Policy Information -->
    <div class="form-section">
      <h2>Policy Information</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="policy_no">Policy Number *</label>
          <input type="text" id="policy_no" formControlName="policy_no" [class.error]="isFieldInvalid('policy_no')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_no')">
            {{ getFieldError('policy_no') }}
          </div>
        </div>
        <div class="form-group">
          <label for="policy_status">Policy Status *</label>
          <select id="policy_status" formControlName="policy_status" [class.error]="isFieldInvalid('policy_status')">
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
            <option value="Pending">Pending</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('policy_status')">
            {{ getFieldError('policy_status') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="policy_type">Policy Type *</label>
          <select id="policy_type" formControlName="policy_type" 
                  [class.error]="isFieldInvalid('policy_type')">
            <option value="Auto">Auto</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('policy_type')">
            {{ getFieldError('policy_type') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="policy_effective_date">Effective Date *</label>
          <input type="date" id="policy_effective_date" formControlName="policy_effective_date" [class.error]="isFieldInvalid('policy_effective_date')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_effective_date')">
            {{ getFieldError('policy_effective_date') }}
          </div>
        </div>
        <div class="form-group">
          <label for="policy_expiration_date">Expiration Date *</label>
          <input type="date" id="policy_expiration_date" formControlName="policy_expiration_date" [class.error]="isFieldInvalid('policy_expiration_date')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_expiration_date')">
            {{ getFieldError('policy_expiration_date') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Policy Holder Information -->
    <div class="form-section">
      <h2>Policy Holder Information</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="policy_holder_first_name">First Name *</label>
          <input type="text" id="policy_holder_first_name" formControlName="policy_holder_first_name" [class.error]="isFieldInvalid('policy_holder_first_name')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_holder_first_name')">
            {{ getFieldError('policy_holder_first_name') }}
          </div>
        </div>
        <div class="form-group">
          <label for="policy_holder_last_name">Last Name *</label>
          <input type="text" id="policy_holder_last_name" formControlName="policy_holder_last_name" [class.error]="isFieldInvalid('policy_holder_last_name')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_holder_last_name')">
            {{ getFieldError('policy_holder_last_name') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="policy_holder_street">Street Address *</label>
          <input type="text" id="policy_holder_street" formControlName="policy_holder_street" [class.error]="isFieldInvalid('policy_holder_street')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_holder_street')">
            {{ getFieldError('policy_holder_street') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="policy_holder_city">City *</label>
          <input type="text" id="policy_holder_city" formControlName="policy_holder_city" [class.error]="isFieldInvalid('policy_holder_city')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_holder_city')">
            {{ getFieldError('policy_holder_city') }}
          </div>
        </div>
        <div class="form-group">
          <label for="policy_holder_state">State *</label>
          <input type="text" id="policy_holder_state" formControlName="policy_holder_state" [class.error]="isFieldInvalid('policy_holder_state')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_holder_state')">
            {{ getFieldError('policy_holder_state') }}
          </div>
        </div>
        <div class="form-group">
          <label for="policy_holder_zip">ZIP Code *</label>
          <input type="text" id="policy_holder_zip" formControlName="policy_holder_zip" [class.error]="isFieldInvalid('policy_holder_zip')">
          <div class="error-message" *ngIf="isFieldInvalid('policy_holder_zip')">
            {{ getFieldError('policy_holder_zip') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Driver Information -->
    <div class="form-section">
      <h2>Driver Information</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="driver_first_name">First Name *</label>
          <input type="text" id="driver_first_name" formControlName="driver_first_name" [class.error]="isFieldInvalid('driver_first_name')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_first_name')">
            {{ getFieldError('driver_first_name') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_last_name">Last Name *</label>
          <input type="text" id="driver_last_name" formControlName="driver_last_name" [class.error]="isFieldInvalid('driver_last_name')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_last_name')">
            {{ getFieldError('driver_last_name') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_age">Age *</label>
          <input type="number" id="driver_age" formControlName="driver_age" [class.error]="isFieldInvalid('driver_age')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_age')">
            {{ getFieldError('driver_age') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="driver_gender">Gender *</label>
          <select id="driver_gender" formControlName="driver_gender" [class.error]="isFieldInvalid('driver_gender')">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('driver_gender')">
            {{ getFieldError('driver_gender') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_marital_status">Marital Status *</label>
          <select id="driver_marital_status" formControlName="driver_marital_status" [class.error]="isFieldInvalid('driver_marital_status')">
            <option value="">Select Status</option>
            <option value="Single">Single</option>
            <option value="Married">Married</option>
            <option value="Divorced">Divorced</option>
            <option value="Widowed">Widowed</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('driver_marital_status')">
            {{ getFieldError('driver_marital_status') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="driver_license_number">License Number *</label>
          <input type="text" id="driver_license_number" formControlName="driver_license_number" [class.error]="isFieldInvalid('driver_license_number')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_license_number')">
            {{ getFieldError('driver_license_number') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_license_state">License State *</label>
          <input type="text" id="driver_license_state" formControlName="driver_license_state" [class.error]="isFieldInvalid('driver_license_state')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_license_state')">
            {{ getFieldError('driver_license_state') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_license_status">License Status *</label>
          <input type="text" id="driver_license_status" formControlName="driver_license_status" [class.error]="isFieldInvalid('driver_license_status')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_license_status')">
            {{ getFieldError('driver_license_status') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="driver_license_effective_date">License Effective Date *</label>
          <input type="date" id="driver_license_effective_date" formControlName="driver_license_effective_date" [class.error]="isFieldInvalid('driver_license_effective_date')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_license_effective_date')">
            {{ getFieldError('driver_license_effective_date') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_license_expiration_date">License Expiration Date *</label>
          <input type="date" id="driver_license_expiration_date" formControlName="driver_license_expiration_date" [class.error]="isFieldInvalid('driver_license_expiration_date')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_license_expiration_date')">
            {{ getFieldError('driver_license_expiration_date') }}
          </div>
        </div>
        <div class="form-group">
          <label for="driver_license_class">License Class *</label>
          <input type="text" id="driver_license_class" formControlName="driver_license_class" [class.error]="isFieldInvalid('driver_license_class')">
          <div class="error-message" *ngIf="isFieldInvalid('driver_license_class')">
            {{ getFieldError('driver_license_class') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Vehicle Information -->
    <div class="form-section">
      <h2>Vehicle Information</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="vehicle_year">Year *</label>
          <input type="number" id="vehicle_year" formControlName="vehicle_year" [class.error]="isFieldInvalid('vehicle_year')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_year')">
            {{ getFieldError('vehicle_year') }}
          </div>
        </div>
        <div class="form-group">
          <label for="vehicle_make">Make *</label>
          <input type="text" id="vehicle_make" formControlName="vehicle_make" [class.error]="isFieldInvalid('vehicle_make')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_make')">
            {{ getFieldError('vehicle_make') }}
          </div>
        </div>
        <div class="form-group">
          <label for="vehicle_model">Model *</label>
          <input type="text" id="vehicle_model" formControlName="vehicle_model" [class.error]="isFieldInvalid('vehicle_model')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_model')">
            {{ getFieldError('vehicle_model') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="vehicle_vin">VIN (17 characters) *</label>
          <input type="text" id="vehicle_vin" formControlName="vehicle_vin" [class.error]="isFieldInvalid('vehicle_vin')" maxlength="17" pattern="[A-HJ-NPR-Z0-9]{17}">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_vin')">
            {{ getFieldError('vehicle_vin') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="vehicle_usage">Usage *</label>
          <select id="vehicle_usage" formControlName="vehicle_usage" [class.error]="isFieldInvalid('vehicle_usage')">
            <option value="">Select Usage</option>
            <option value="Pleasure">Pleasure</option>
            <option value="Commuting">Commuting</option>
            <option value="Business">Business</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_usage')">
            {{ getFieldError('vehicle_usage') }}
          </div>
        </div>
        <div class="form-group">
          <label for="vehicle_primary_use">Primary Use *</label>
          <select id="vehicle_primary_use" formControlName="vehicle_primary_use" [class.error]="isFieldInvalid('vehicle_primary_use')">
            <option value="">Select Primary Use</option>
            <option value="Commuting">Commuting</option>
            <option value="Pleasure">Pleasure</option>
            <option value="Business">Business</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_primary_use')">
            {{ getFieldError('vehicle_primary_use') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="vehicle_annual_mileage">Annual Mileage *</label>
          <input type="number" id="vehicle_annual_mileage" formControlName="vehicle_annual_mileage" [class.error]="isFieldInvalid('vehicle_annual_mileage')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_annual_mileage')">
            {{ getFieldError('vehicle_annual_mileage') }}
          </div>
        </div>
        <div class="form-group">
          <label for="vehicle_ownership">Ownership *</label>
          <select id="vehicle_ownership" formControlName="vehicle_ownership" [class.error]="isFieldInvalid('vehicle_ownership')">
            <option value="">Select Ownership</option>
            <option value="Owned">Owned</option>
            <option value="Leased">Leased</option>
            <option value="Financed">Financed</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_ownership')">
            {{ getFieldError('vehicle_ownership') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Garaging Address -->
    <div class="form-section">
      <h2>Garaging Address</h2>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="vehicle_garaging_street">Street Address *</label>
          <input type="text" id="vehicle_garaging_street" formControlName="vehicle_garaging_street" [class.error]="isFieldInvalid('vehicle_garaging_street')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_garaging_street')">
            {{ getFieldError('vehicle_garaging_street') }}
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="vehicle_garaging_city">City *</label>
          <input type="text" id="vehicle_garaging_city" formControlName="vehicle_garaging_city" [class.error]="isFieldInvalid('vehicle_garaging_city')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_garaging_city')">
            {{ getFieldError('vehicle_garaging_city') }}
          </div>
        </div>
        <div class="form-group">
          <label for="vehicle_garaging_state">State *</label>
          <input type="text" id="vehicle_garaging_state" formControlName="vehicle_garaging_state" [class.error]="isFieldInvalid('vehicle_garaging_state')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_garaging_state')">
            {{ getFieldError('vehicle_garaging_state') }}
          </div>
        </div>
        <div class="form-group">
          <label for="vehicle_garaging_zip">ZIP Code *</label>
          <input type="text" id="vehicle_garaging_zip" formControlName="vehicle_garaging_zip" [class.error]="isFieldInvalid('vehicle_garaging_zip')">
          <div class="error-message" *ngIf="isFieldInvalid('vehicle_garaging_zip')">
            {{ getFieldError('vehicle_garaging_zip') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Coverage Information -->
    <div class="form-section">
      <h2>Coverage Information</h2>
      <div formArrayName="coverages">
        <div *ngFor="let coverage of coverages.controls; let i = index" [formGroupName]="i" class="coverage-item">
          <h3>Coverage {{ i + 1 }}</h3>
          <div class="form-row">
            <div class="form-group">
              <label [for]="'coverage_type_' + i">Coverage Type *</label>
              <select [id]="'coverage_type_' + i" formControlName="type" [class.error]="isFieldInvalid(`coverages.${i}.type`)">
                <option value="">Select Type</option>
                <option value="Liability">Liability</option>
                <option value="Collision">Collision</option>
                <option value="Comprehensive">Comprehensive</option>
                <option value="Personal Injury Protection">Personal Injury Protection</option>
                <option value="Uninsured Motorist">Uninsured Motorist</option>
              </select>
              <div class="error-message" *ngIf="isFieldInvalid(`coverages.${i}.type`)">
                {{ getFieldError(`coverages.${i}.type`) }}
              </div>
            </div>
            <div class="form-group">
              <label [for]="'coverage_limit_' + i">Coverage Limit *</label>
              <input type="number" [id]="'coverage_limit_' + i" formControlName="limit" min="0" [class.error]="isFieldInvalid(`coverages.${i}.limit`)">
              <div class="error-message" *ngIf="isFieldInvalid(`coverages.${i}.limit`)">
                {{ getFieldError(`coverages.${i}.limit`) }}
              </div>
            </div>
            <div class="form-group">
              <label [for]="'coverage_deductible_' + i">Deductible *</label>
              <input type="number" [id]="'coverage_deductible_' + i" formControlName="deductible" min="0" [class.error]="isFieldInvalid(`coverages.${i}.deductible`)">
              <div class="error-message" *ngIf="isFieldInvalid(`coverages.${i}.deductible`)">
                {{ getFieldError(`coverages.${i}.deductible`) }}
              </div>
            </div>
            <div class="form-group">
              <button type="button" class="btn btn-danger" (click)="removeCoverage(i)" [disabled]="coverages.length === 1">Remove</button>
            </div>
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-secondary" (click)="addCoverage()">Add Coverage</button>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="policyForm.invalid || loading">
        {{ isEditMode ? 'Update Policy' : 'Create Policy' }}
      </button>
      
    </div>
  </form>
</div>